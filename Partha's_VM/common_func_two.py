import psycopg2
import requests

store_recipients = {

     277:6289378874 ,  #  GARIAHAT,Yamin,1
     256:8910287436 ,  #  NEW ALIPORE,SWARMILA,2
     245:8240667843 ,  #  JODHPUR MARKET,CHIRANJIT,6
     246:8145105680 ,  #  JODHPUR PARK,BIDHU,7
     283:8910840835 ,  #  KALIGHAT,SUBHASHIS,8
     321:7003172667 ,  #  SOUTH CITY,TAIGH ALI,9
     315:9749179873 ,  #  PRINCE ANWAR SHAH,ANUP HALDER,10
     299:8910390801 ,  #  HARISH MUKHERJEE,TAPAS KUMAR BARIK,11
     234:9073742937 ,  #  GRAND,HALIM GAZI,12
     308:9734528533 ,  #  MEDI AID,SK AJGAR ALI,14
     301:7890006937 ,  #  SURYA SEN STREET,PRASANTA SINGH,15
     287:7890404780 ,  #  HOWRAH,MITHUN GARUI,16
     218:9062493045 ,  #  SHYAMBAZAR,AMIT DAS,17
     255:9830260050 ,  #  EKBALPORE,TAPAS PANDA,18
     232:6291908223 ,  #  KESTOPUR,SUBHASHIS DAS,20
     215:6290451911 ,  #  PARK CIRCUS,AMAL ROY,21
     263:9903192984 ,  #  BANSDRONI,SUBARNA SUR,22
     216:9062761620 ,  #  PHOOL BAGAN,SUBRATA,23
     271:9748460377 ,  #  DUMDUM,SURAJIT GHOSH,24
     212:8697666037 ,  #  MULLICK BAZAR,TOUFIK KHAN,25
     231:9051740645 ,  #  KAIKHALI,SHIB SANKAR ROY,26
     229:9330473639 ,  #  BANGUR AVENUE,SUMON KUNDU,27
     217:8334931942 ,  #  SHYAM NAGAR,TUMPA,28
     206:8697015255 ,  #  HATIBAGAN,PRADIPTA BISWAS,29
     228:7003801525 ,  #  BAGUIATI,BIVA SINGHA ROY,30
     296:9903890747 ,  #  KASBA,BUDDHA,32
     428:9547038347 ,  #  KHARAGPUR IIT,ASHOKE DEY,37
     244:8910266762 ,  #  GANGULY BAGAN,AMIT DEY,38
     251:7890004149 ,  #  AMTALA,SUVOJIT ROY,40
     219:7980879974 ,  #  GANESH TALKIES,BISHAL BASAK,41
     275:9143859987 ,  #  GARIA HINDUSTAN,TARUN DAS,42
     306:6291375063 ,  #  MALANCHA 1,PRASENJIT ROY,43
     276:7439111905 ,  #  GARIA MORE,PRASENJIT PAL,44
     252:9830536815 ,  #  BEHALA BARISHA,JAYANTA CHOWDHURY,45
     203:8240783599 ,  #  CIT ROAD,Rupayan SAHA,46
     238:9874068629 ,  #  DLF IT PARK,GAUTAM MAJUMDER,47
     241:7278670225 ,  #  BAGHAJATIN,KRISHNENDU DUTTA,49
     267:9339534936 ,  #  BEHALA SHAKUNTALA P,KOILASH MURARKA,50
     302:8981602900 ,  #  KUDGHAT,AVIJIT GYEN,51
     266:7980673039 ,  #  BARRACKPORE,SOUMYA,54
     249:8697654821 ,  #  PATULI BP,PRADIP KR DAS,55
     289:9163981528 ,  #  HOWRAH SALKIA,BISHAL KR BARMA,56
     304:9088517546 ,  #  LAKE MARKET,KALU DOLUI,57
     227:7076114321 ,  #  UTTARPARA,SAMIK PAL,58
     288:8777043604 ,  #  HOWRAH LILUAH,PARITOSH KUNDU,59
     297:8697347447 ,  #  BHOWANIPUR,MANISH ROY,61
     222:6296084983 ,  #  BURDWAN,PRABIR CHATTERJEE,63
     303:6291555427 ,  #  LAKE GARDENS,SRABANTI MAJHI,64
     318:9231956123 ,  #  SALT LAKE PETROL PUMP,PRADIP PRADHAN,65
     210:9874962122 ,  #  MANIKTALA,SUJIT KUMAR DAS,66
     247:9836856837 ,  #  NARENDRAPUR,SATYAJIT DAS,67
     269:7450081955 ,  #  BIJOYGARH,RAJA,68
     262:9681981463 ,  #  AVISHIKTA,TARAK NATH BAITALI,69
     311:7908085452 ,  #  NAIHATI,BAPI BAG,71
     205:7003048114 ,  #  GURUSADAY,TUTUL ROY,76
     298:9007278108 ,  #  KHARDAH,ASISH SUTRADHAR,79
     260:7044458892 ,  #  THAKURPUKUR,KARTIK BAG,80
     388:8910390801 ,  #  HARISH MUKHERJEE 2,TAPAS BARIK,81
     208:8697313947 ,  #  KARAYA ROAD,S A KHAN,82
     243:9647503822 ,  #  BARUIPUR,ABDUR RAJJAK TARAFDAR,83
     254:9062826170 ,  #  BUDGE BUDGE,MALAY NATH,84
     259:8334818101 ,  #  T C ROAD,BISWAJIT GAYEN,85
     286:6290580456 ,  #  KALYANI,SUMIT BANERJEE,86
     319:9874785381 ,  #  SANTOSHPUR,TAPAS SARDAR,87
     213:9038573112 ,  #  NRS,SIVAM DEY,88
     270:8697224131 ,  #  CHAMPADALI,ARUP GHOSH,91
     274:9163934380 ,  #  ANDUL ROAD,BISWAJIT MONDAL,92
     310:9123860726 ,  #  NAGERBAZAR,ASHOKE SAHA,93
     224:9903794905 ,  #  RISHRA,ANANDA PAN,96
     242:8961289890 ,  #  BALLYGUNGE STATION,Swapan BOSE,97
     253:8584067769 ,  #  BEHALA HARISABHA,RANAJIT KARMAKAR,98
     285:9933904737 ,  #  KALIKAPUR,JOYGOPAL JANA,99
     235:9002645506 ,  #  HALDIA,SURJADEB MAITY,100
     236:8373875546 ,  #  TAMLUK,Barun HAZRA,101
     350:9564420617 ,  #  MIDNAPORE ALIGUNJ,ANUPAM PATRA,102
     284:8961374414 ,  #  DANESH SEIKH LANE,Bubun KARMAKAR,104
     257:9748272759 ,  #  RASH BEHARI AVENUE,SANJAY MONDAL,105
     291:8585093506 ,  #  RAMRAJATALA,AFTAR ALI,107
     239:8296365134 ,  #  KWALITY SALT LAKE,MINTU PAL,108
     230:9163418808 ,  #  CITY CENTRE II,BISWAJIT JANA,110
     307:9051308452 ,  #  MALANCHA 2,ARUP KANTI RAY,111
     323:9800965010 ,  #  TOLLYGUNGE METRO,AMIT DEY,112
     237:6290040775 ,  #  DLF GALLERIA,SUJIT DAS,113
     225:6291379354 ,  #  SERAMPORE,SUNY ADHIKARY,118
     209:9874990122 ,  #  LAKE TOWN,ANJAN NANDI,119
     258:7890007744 ,  #  ROY BAHADUR RD,DULAL CHANDRA MANDAL,120
     320:9123888358 ,  #  SHYAMNAGAR KALIBARI,SUMAN BHOWMICK,121
     312:7003228549 ,  #  NAIHATI GARUR FARI,SAMIRAN PAN,122
     220:9674483276 ,  #  MINTO PARK,BIJOY KUMAR CHOUDHURY,123
     201:7044624191 ,  #  ALAM BAZAR,RAKESH DAS,124
     202:9007292335 ,  #  BARANAGAR,SOMNATH GHOSH,125
     214:9163213273 ,  #  P K GUHA ROAD,BANANI MALLICK,126
     292:7908463282 ,  #  KANCHRAPARA,SUDIP PAUL,128
     280:8777359417 ,  #  ICHAPORE,SURAJIT NANDI,129
     250:6295950091 ,  #  RAJPUR,BASUDEV BISWAS,130
     273:8481081213 ,  #  ECO SPACE RAJARHAT,BABAI KARMAKAR,131
     316:9038136553 ,  #  RABINDRA SAROBAR,MONINDRA SIKHARI,132
     223:6291618419 ,  #  CHANDANNAGAR,SREOSHI BANERJEE,133
     293:9038572739 ,  #  KANKINARA,SUMAN CHOWDHURY,134
     317:9064788231 ,  #  RANAGHAT,SWARNALI DEY,135
     300:8617422094 ,  #  KRISHNANAGAR,SOUMEN KUNDU,136
     290:9875526149 ,  #  KALYANI 2,SUKANTA DAS,137
     221:8597747971 ,  #  KADAMTALA,SUKDEB MANNA,138
     226:8981917456 ,  #  ULUBERIA,FARID MULLICK,139
     322:7686945035 ,  #  TITAGARH,CHANDAN PASOWAN,140
     265:9875663571 ,  #  BARASAT,SANJIB SAHA,142
     295:8617223166 ,  #  KANKINARA RATHTALA,SAJAL BISWAS,143
     369:9163510643 ,  #  TCS,RAJA DEY,144
     207:7980213139 ,  #  KANKURGACHI 1,NITIN KUMAR PAUL,145
     278:9564819883 ,  #  HABRA,SOMENATH DAS,146
     272:9477046448 ,  #  DUTTAPUKUR,MITHUN SAHA,147
     281:7980634997 ,  #  CHATTERJEE HAT,PROSENJIT GHOSH,148
     305:9002003641 ,  #  MADHYAMGRAM,SIBASIS PAUL,149
     261:8617474524 ,  #  ASHOKENAGAR,Mriganka Das,150
     279:6289744210 ,  #  BATAITALA,SUBHAM,151
     282:8777036973 ,  #  ICHAPORE KANTHADHAR,Ganapti Mondal,152
     268:8777642220 ,  #  BHATPARA,DANISH PARVEZ,153
     233:9563076660 ,  #  CHAITANYAPUR,ABHIJIT,155
     240:9748994226 ,  #  SALT LAKE GATE,J P RAO,156
     294:8240496289 ,  #  SHIBPUR BE COLLEGE,SUSHIL YADAV,157
     326:9088562870 ,  #  MADANPUR,SURAJIT SARKAR,158
     327:8337064626 ,  #  PAYRADANGA,SHIV SANKAR,159
     325:8918507640 ,  #  HARINGHATA,SOURAV,160
     389:8777819264 ,  #  SAJIRHAT,ANANYA,161
     358:7029224243 ,  #  CHANDPARA,SANDIP,162
     352:7864099664 ,  #  BONGAON,Arijit Ghosh,163
     356:9123621946 ,  #  BURDWAN CURZON GATE,TANAY,167
     355:7003958810 ,  #  SINGUR,SANDIP GOSWAM,168
     387:9903944466 ,  #  JOYNAGAR,SUJAY DAS,169
     363:7872239667 ,  #  LAKHHIKANTHAPUR,Sangita ghosh,170
     354:6291120903 ,  #  KONNAGAR,SRIJAN DAS,171
     359:7980404251 ,  #  CHINSURAH,Debobrata Poddar,172
     357:9038574599 ,  #  BELGHORIA,ASIT,173
     361:7679840699 ,  #  CHAKDAHA,SAJAL,174
     360:9800815243 ,  #  JODHPUR PARK BOYS,DILIP MONDAL,175
     447:7699182740 ,  #  BARUIPUR PURATAN BAZAR,RAJIB,177
     367:9732933145 ,  #  DAKSHIN BARASAT,ABHIJIT MONDAL,178
     500:9831916811 ,  #  MASLANDPUR,SANJIB SARKAR,182
     366:9073190283 ,  #  CHINTAMONI,ARIJIT BHATTACHARYA,183
     518:7980225644 ,  #  JAGADDAL,SUNNY MAHATO,184
     370:8240027227 ,  #  KANCHRAPARA BAGMORE,TAPAN,185
     377:9851556762 ,  #  CONTAI,Nani Gopal Shaw,186
     390:9073019759 ,  #  SONARPUR DREAM PARK,TUHIN MANNA,187
     386:9903474879 ,  #  KAMARHATI SAGAR DUTTA,JOYDEB MAJUMDER,188
     429:9679278570 ,  #  BASIRHAT,SUJOY,192
     376:9903519172 ,  #  NABADWIP BRANCH,PRASENJIT,193
     371:7044756476 ,  #  DOMJUR HOSPITAL,N P MONDAL,194
     375:7872727165 ,  #  BHAGWANGOLA,RAHUL,197
     372:7031877548 ,  #  LALGOLA,UJJAL,198
     374:8617886167 ,  #  JIAGANJ,SUMAN DAS,199
     540:9593852600 ,  #  BAJKUL,SOMSANKAR DA,210
     384:7001335103 ,  #  ASANSOL SRISTINAGAR,DEBASISH HAJRA,214
     391:9903342270 ,  #  BONGAON-BATA MORE,SANATAN GHOSH,216
     430:9735249596 ,  #  ARAMBAGH,MONOJIT NAG,218
     483:8777876028 ,  #  PADDAPUKUR SARAT BOSE RD,PIJUSH KANTI DAS,219
     497:8372926359 ,  #  SILIGURI PAKURTALA,NIRUPAM ROY,220
     491:9641181156 ,  #  SILIGURI BIDHAN ROAD,ASHOK ROY,221
     426:6297209967 ,  #  BANKURA,SANDIP PRAMANIK,223
     427:7679794671 ,  #  ASANSOL SB GORAI,NARESH KUMAR SHARMA,224
     442:7003518882 ,  #  BANDEL,SUKHENDU HALDER,225
     464:9831236924 ,  #  DUNLOP,SHANKAR NATH LAHIRI,227
     440:8653783058 ,  #  DHANIAKHALI,RAJ KIRAN PATHAK,228
     441:9851559882 ,  #  SURI,APU DAS,229
     450:9382344955 ,  #  PURULIA BUS STAND,DEEP KARMAKAR,230
     517:9875405145 ,  #  PURULIA HATER BAZAR,TAPAN KUMAR HAJRA,231
     439:6291330910 ,  #  HALISAHAR,PINTU DAS,232
     444:9007979249 ,  #  CHINSURAH TOLAFATAK,ANIMESH KUNDU,233
     443:8926265699 ,  #  KGP PURATAN BAZAR,SATTYAJIT SIL,234
     452:8906524898 ,  #  RAMPURHAT,AVIJIT CHAKRABORTY,236
     493:9474647981 ,  #  RANIBAGAN,MALAY KUMAR SINGHA,238
     488:9749155869 ,  #  KASIM BAZAR,SUBHENDU DAS,239
     536:7003680578 ,  #  NAGERBAZAR MOTIJHIL,SOMENATH DAS,240
     475:9933516614 ,  #  SONARPUR BAZAR,DEBDAS GAIN,241
     448:8013277026 ,  #  KOLAGHAT,SK SAMIM AHMED,242
     446:9126355796 ,  #  MECHEDA,AJIT MANNA,243
     510:9046947631 ,  #  SHEORAPHULI,poltu rui das,244
     457:7550844670 ,  #  BAGNAN,SAMANTA DA,245
     492:8697804906 ,  #  NARAYANPUR,debasis das,246
     473:6292310883 ,  #  ARANGHATA,SANJIB,247
     502:7595924528 ,  #  SHYAMNAGAR FEEDER ROAD,soumitra kumar das,248
     471:8250608046 ,  #  DANGALPARA,suman bhatacherjee,249
     499:9647486908 ,  #  RAJNAGAR BAZAR,taj uddin,250
     538:6294864634 ,  #  DUBRAJPUR BAZAR,-SK MEHEBUB ALAM,251
     511:9832136101 ,  #  SAINTHIA STATION ROAD,anower hossan,252
     512:8101402425 ,  #  AHAMEDPUR,tapas mondal,253
     544:9339132098 ,  #  SILIGURI MEDICAL,kartik roy,254
     533:8945975258 ,  #  JITUSOL,TAPAS DEHARI,255
     474:9734750685 ,  #  KATWA,SANJIB DAS,256
     470:6290848863 ,  #  DANKUNI,KISHAN DHAR,257
     513:8017661847 ,  #  RAMPURHAT JLB ROAD,KARTIK MANDAL,258
     463:8158846019 ,  #  CONTAI SUPER MARKET,SOUMEN DAS,259
     498:9609773770 ,  #  BANKURA KATJURIDANGA,ABHIJIT RAJAK,260
     519:7908611235 ,  #  JALPAIGURI PANDA PARA,SOUVIK DEY SARKAR,261
     472:8250960326 ,  #  ILLAMBAZAR,TUHINUL HAQUE,262
     484:9163628566 ,  #  PS 102 JOKA,BISWAJIT BIZAWLI,263
     494:8420726872 ,  #  KHAGRA BAZAR,Nityanada Sarkar,265
     487:9609677765 ,  #  SAGARDIGHI,Jaharlal Tiwari,266
     482:9749752649 ,  #  GHATAL KUSHPATA,Tribikram Sahoo,267
     485:8001615088 ,  #  KANDI,BIVAS PATUA,268
     489:9123367213 ,  #  AGARPARA,Suparna Dutta,269
     504:8346058654 ,  #  SILIGURI BHANU NAGAR,ASHIS RAUT,270
     505:6297719219 ,  #  RAIGANJ PRANABANANDA SARANI,MD DULAL,271
     506:9088010179 ,  #  RAIGANJ STATION ROAD,Avi Roy,272
     507:9038055220 ,  #  RAIGANJ MOHANBATI,Tanmoy maji,273
     525:9679466602 ,  #  RAMNAGAR SAIYADPUR,Prasenjit Jana,274
     495:9073020033 ,  #  CHAMPAHATI,PALASH MONDAL,275
     509:8001332426 ,  #  SITAPUR GANESHBATI,Subarna Pramanik,276
     514:8116674330 ,  #  BALURGHAT HILI MORE,BIMAN MOHOTA,277
     503:8768948919 ,  #  BALURGHAT DUNLOP MORE,Vikey ghosh,278
     529:7001524717 ,  #  KALIACHAK,EZAZ AHMED,279
     486:7908057565 ,  #  ASANSOL HUTTON ROAD,Rajen thakur,280
     526:7602895331 ,  #  DOMJUR BAZAR JELEPARA,Debabrata Shit,281
     515:7683001508 ,  #  GANGARAMPUR,Sujan Halder,282
     520:9804770030 ,  #  SODEPUR GB DUUTA ROAD,Pradipta Das,283
     501:7908409602 ,  #  DURGAPUR BENACHITY,Devpriyo Bir,284
     521:9239351372 ,  #  RAIGACHI,Rajib Ghosh,285
     528:9903519172 ,  #  SUKHOBRISTI,PRASENJIT SARKAR,287
     546:6290350673 ,  #  BIRATI,GOUTAM ROY,288
     534:9609449437 ,  #  BARASAT KAZIPARA,Sudip Kar,289
     545:9051539336 ,  #  MAKARDAH,Soham Golui,290
     531:9975945354 ,  #  DINHATA,Surajit Barman,292
     535:9733651880 ,  #  BASIRHAT THANA,PINAKI CHATERJEE,293
     532:8927098326 ,  #  COOCHBEHAR BHAWANIGANJ BAZAR,Debesh Chowdhury,294
     522:9932076061 ,  #  KUSHMUNDI,Sujay Rajbanshi,295
     542:7550930708 ,  #  DALKHOLA,SHIBU DAS,296
     541:9775127656 ,  #  TUNGIDIGHI,IMRAN ALI,299
     539:8016657984 ,  #  CHANCHAL,ANINDITA BHATTACHERJEE,300
     436:9366052292 ,  #  TRIPURA BATTALA,SANJIB DAS,460
     466:8837408512 ,  #  MATHCHOWMOHANI,CHOTON DAS,461
     432:7677580420 ,  #  JAKARIAPUR,ATUL PADARTH,481
     476:9804491759 ,  #  MEENA BAZAR,KRIPLAL ,482
     477:9279434070 ,  #  PHULWARISHARIF,DIPAK KUMAR,483
     478:9304738040 ,  #  DARIAPUR,RAKESH KUMAR,484
     479:8083741324 ,  #  LOHANIPUR,ARUN KUMAR ,485
     553:8101984101 ,  #  NANDIGRAM,SOUMIK DAS,492
     552:8617593950    #  KALIAGANJ,BISWAJIT DAS,493
}

send_message_switch = True

def send_SMS_100coins_two(all_recipients, message) :

    message  += " - Frank Ross"
    print('sending sms with message as ', message, 'to ', all_recipients)
    
#    message = "Dear Customer, use OTP 112234 to login to your account. - Frank Ross LiWgYVOs+fF"

    if send_message_switch :
        if len(all_recipients) != 0 :
            URL = "https://api.100coins.co/v3/smsget"
            for customer_phone in all_recipients:
                PARAMS = {"apikey": "yYqGnoBIGd1QMeofVisxWdRvxfQWr9rJ",
                          "mtype" : 0,
                          "mask"  : "FKROSS",
                          "mobno" : customer_phone,
                          "message" : message}
                r = requests.get(url = URL, params = PARAMS)
                print(r.json())


def process_two(query, admin_recipients, id_index, store_index, store_name_index, prefix, use_store_recipient) :

    MAX_ORDER_LIMIT = 1

    conn = psycopg2.connect(database = "efrprod",
                            user = "emamireaduser",
                            host = "emami-fr-prod-db.crknf6guwalh.ap-south-1.rds.amazonaws.com",
                            port = 5432,
                            password = "emamireadaccess")

    cur = conn.cursor()

    cur.execute(query)

    rows = cur.fetchall()

    
    if len(rows) == 0 :
        print("No Records")
        return
        
    store = None
    order_counter = 0
    message = None
    for row in rows:
        if row[store_index] != store :
            if store != None :
               print("[1]sending the messsage for store ", store)
               send_SMS_100coins_two(all_recipients, message)
               order_counter = 0;
            all_recipients = admin_recipients.copy()
            message = prefix + " "
            if use_store_recipient and \
               row[store_index] in store_recipients.keys() \
               and store_recipients[row[store_index]] not in all_recipients:
              all_recipients.append(store_recipients[row[store_index]])
            message = message + str(row[id_index]) + " " + str(row[store_name_index])
            store = row[store_index]
            order_counter += 1
        else:
            if order_counter == MAX_ORDER_LIMIT :
              print("[2]sending the messsage for store ", store)
              send_SMS_100coins_two(all_recipients, message)
              order_counter = 0;
              all_recipients = admin_recipients.copy()
              message = prefix + " "
              if use_store_recipient and \
                 row[store_index] in store_recipients.keys() \
                 and store_recipients[row[store_index]] not in all_recipients:
                all_recipients.append(store_recipients[row[store_index]])
              message = message + str(row[id_index]) + " " + str(row[store_name_index])
              order_counter += 1
            else :
              message += "," + str(row[id_index]) + " " + str(row[store_name_index])
              order_counter += 1
    print("[3]sending the messsage for store ", store)
    send_SMS_100coins_two(all_recipients, message)
    
